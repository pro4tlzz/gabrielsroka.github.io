<!doctype html>
<html>
<head>
<meta name=viewport content='initial-scale=1.0, minimum-scale=0.25'>
<title>Export Zendesk Agents To CSV</title>
<style>
body {
    font-family: sans-serif;
}
</style>
</head>
<body>
<h1>Export Zendesk Agents To CSV</h1>
<p>This tool will export Zendesk agents to a CSV file.</p>
<b>Setup</b>
<ol>
<li>Show your bookmarks toolbar. In Chrome, â€¦ > Bookmarks > Show Bookmarks Bar. In Firefox, right-click in the title bar and click Bookmarks Toolbar.
<li>Drag/drop this <a id=bm>Export Agents</a> to the bookmarks toolbar.
</ol>
<br>
<b>Usage</b>
<ol>
<li>Open Zendesk and sign in.
<li>Click the "Export Agents" button from your bookmarks toolbar. 
</ol>
<br>
<a href=https://github.com/gabrielsroka/gabrielsroka.github.io/blob/master/ExportZendeskAgentsToCSV.html>Source code</a>
<script id=code>
(async function () {
    /* See https://developer.zendesk.com/api-reference/ticketing/ticket-management/search/ */
    const results = [];
    for await (const data of getPages('/api/v2/search.json?query=role:agent')) { /* &per_page=1, page=2 */
        data.forEach(r => results.push(toCSV(r.id, r.email, r.name, r.role, r.active)));
    }

    downloadCSV('id,email,name,role,active', results, 'Zendesk Agents');

    /* all columns:
        'active', 'alias', 'created_at', 'custom_role_id', 'default_group_id', 'details', 'email', 
        'external_id', 'iana_time_zone', 'id', 'last_login_at', 'locale', 'locale_id', 'moderator', 'name', 'notes', 
        'only_private_comments', 'organization_id', 'phone', 'photo', 'report_csv', 'restricted_agent', 'result_type', 
        'role', 'role_type', 'shared', 'shared_agent', 'shared_phone_number', 'signature', 'suspended', 'tags', 
        'ticket_restriction', 'time_zone', 'two_factor_auth_enabled', 'updated_at', 'url', 'user_fields', 'verified'
    */

    async function* getPages(url) {
        while (url) {
            const response = await fetch(url);
            const page = await response.json();
            yield page.results;
            url = page.next_page;
        }
    }
    function downloadCSV(header, lines, filename) {
        const a = document.body.appendChild(document.createElement("a"));
        a.href = URL.createObjectURL(new Blob([header + "\n" + lines.join("\n")], {type: 'text/csv'}));
        const date = (new Date()).toISOString().replace(/T/, " ").replace(/:/g, "-").slice(0, 19);
        a.download = `${filename} ${date}.csv`;
        a.click();
        document.body.removeChild(a);
    }
    function toCSV(...fields) {
        return fields.map(field => `"${field == undefined ? "" : field.toString().replace(/"/g, '""')}"`).join(',');
    }
})
</script>
<script>
bm.href = 'javascript:' + code.innerText + '();';
</script>
</body>
</html>
